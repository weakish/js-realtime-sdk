{"version":3,"file":"typed-messages.min.js","sources":["../src/storage.js","../src/realtime.js","../src/file-message.js","../src/image-message.js","../src/audio-message.js","../src/video-message.js","../src/location-message.js","../src/index.js"],"sourcesContent":["/* eslint-disable import/no-unresolved */\nimport { File } from 'leancloud-storage';\n\nif (!File) {\n  throw new Error('LeanCloud Storage SDK not installed');\n}\n\nexport { File, GeoPoint } from 'leancloud-storage';\n","/* eslint-disable import/no-unresolved */\nimport { TypedMessage } from 'leancloud-realtime';\n\nif (!TypedMessage) {\n  throw new Error('LeanCloud Realtime SDK not installed');\n}\n\nexport {\n  TypedMessage,\n  messageType,\n  messageField,\n  IE10Compatible,\n} from 'leancloud-realtime';\n","import { File } from './storage';\nimport {\n  TypedMessage,\n  messageType,\n  messageField,\n  IE10Compatible,\n} from './realtime';\n\nexport default class FileMessage extends TypedMessage {\n  /**\n   * @extends TypedMessage\n   * @param  {AV.File} file LeanCloud 存储 SDK 中的 AV.File 实例，且必须是已经保存到服务端上的 File 实例\n   * （如果是刚刚创建的，必须 save 后才能用于创建 FileMessage）\n   */\n  constructor(file) {\n    if (!(file instanceof File)) {\n      throw new TypeError('file must be an AV.File');\n    }\n    if (typeof file.id !== 'string') {\n      throw new Error('file must be saved before used to create a Message');\n    }\n    super();\n    this._file = file;\n    this._lcfile = {\n      objId: file.id,\n      url: file.url(),\n      metaData: Object.assign(file.metaData() || {}, {\n        name: file.name(),\n      }),\n    };\n  }\n\n  /**\n   * 在客户端需要以文本形式展示该消息时显示的文案，格式为 <code>[类型] file.name()</code>\n   * @type {String}\n   * @readonly\n   */\n  get summary() {\n    return `[${this.constructor._summaryType}] ${this._file.name() ||\n      ''}`.trim();\n  }\n\n  /**\n   * 获得 file 对象\n   * @return {AV.File}\n   */\n  getFile() {\n    return this._file;\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      file: this.getFile().toJSON(),\n    };\n  }\n\n  static _parseFileFromRawData(data) {\n    if (!(data && data._lcfile)) {\n      throw new Error('malformed FileMessage content');\n    }\n    let id = data._lcfile.objId;\n    if (typeof id !== 'string') {\n      id = '';\n    }\n    const file = File.createWithoutData(id);\n    file.attributes = file.attributes || {};\n    file._url = data._lcfile.url;\n    file.attributes.url = file._url;\n    file._metaData = data._lcfile.metaData || {};\n    file.attributes.metaData = file._metaData;\n    if (data._lcfile.metaData) {\n      file._name = data._lcfile.metaData.name;\n      file.attributes.name = file._name;\n    }\n    return file;\n  }\n\n  static parse(json, message) {\n    const file = this._parseFileFromRawData(json);\n    return TypedMessage.parse(json, message || new this(file));\n  }\n}\n\nFileMessage._summaryType = '文件';\n\n/**\n * @name TYPE\n * @memberof FileMessage\n * @type Number\n * @static\n * @const\n */\nmessageType(-6)(FileMessage);\nmessageField('_lcfile')(FileMessage);\nIE10Compatible(FileMessage);\n","import FileMessage from './file-message';\nimport { messageType, IE10Compatible } from './realtime';\n\n/**\n * 构造方法参数同 {@link FileMessage}\n *\n * @extends FileMessage\n */\nclass ImageMessage extends FileMessage {}\nImageMessage._summaryType = '图片';\n\n/**\n * @name TYPE\n * @memberof ImageMessage\n * @type Number\n * @static\n * @const\n */\nmessageType(-2)(ImageMessage);\nIE10Compatible(ImageMessage);\n\nexport default ImageMessage;\n","import FileMessage from './file-message';\nimport { messageType, IE10Compatible } from './realtime';\n\n/**\n * 构造方法参数同 {@link FileMessage}\n *\n * @extends FileMessage\n */\nclass AudioMessage extends FileMessage {}\nAudioMessage._summaryType = '语音';\n\n/**\n * @name TYPE\n * @memberof AudioMessage\n * @type Number\n * @static\n * @const\n */\nmessageType(-3)(AudioMessage);\nIE10Compatible(AudioMessage);\n\nexport default AudioMessage;\n","import FileMessage from './file-message';\nimport { messageType, IE10Compatible } from './realtime';\n\n/**\n * 构造方法参数同 {@link FileMessage}\n *\n * @extends FileMessage\n */\nclass VideoMessage extends FileMessage {}\nVideoMessage._summaryType = '视频';\n\n/**\n * @name TYPE\n * @memberof VideoMessage\n * @type Number\n * @static\n * @const\n */\nmessageType(-4)(VideoMessage);\nIE10Compatible(VideoMessage);\n\nexport default VideoMessage;\n","import { GeoPoint } from './storage';\nimport {\n  TypedMessage,\n  messageType,\n  messageField,\n  IE10Compatible,\n} from './realtime';\n\nexport default class LocationMessage extends TypedMessage {\n  /**\n   * @extends TypedMessage\n   * @param  {AV.GeoPoint} geoPoint LeanCloud 存储 SDK 中的 AV.GeoPoint 实例\n   */\n  constructor(geoPoint) {\n    if (!(geoPoint instanceof GeoPoint)) {\n      throw new TypeError('geoPoint must be an AV.GeoPoint');\n    }\n    super();\n    this._geoPoint = geoPoint;\n    const { latitude, longitude } = geoPoint;\n    this._lcloc = { latitude, longitude };\n  }\n\n  /**\n   * 在客户端需要以文本形式展示该消息时显示的文案，格式为 <code>[位置] message.text</code>\n   * @type {String}\n   * @readonly\n   */\n  get summary() {\n    return `[位置] ${this.text || ''}`.trim();\n  }\n\n  /**\n   * 获得 geoPoint 对象\n   * @return {AV.GeoPoint}\n   */\n  getLocation() {\n    return this._geoPoint;\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      location: this.getLocation().toJSON(),\n    };\n  }\n\n  static parse(json, message) {\n    const { latitude, longitude } = json._lcloc;\n    const geoPoint = new GeoPoint({ latitude, longitude });\n    return TypedMessage.parse(json, message || new this(geoPoint));\n  }\n}\n\n/**\n * @name TYPE\n * @memberof LocationMessage\n * @type Number\n * @static\n * @const\n */\nmessageType(-5)(LocationMessage);\nmessageField('_lcloc')(LocationMessage);\nIE10Compatible(LocationMessage);\n","/** @module leancloud-realtime-plugin-typed-messages */\n\nimport FileMessage from './file-message';\nimport ImageMessage from './image-message';\nimport AudioMessage from './audio-message';\nimport VideoMessage from './video-message';\nimport LocationMessage from './location-message';\nimport { name } from '../package.json';\n\n/**\n * TypedMessages 插件，使用后可支持接收 LeanCloud 提供的富媒体类型的消息\n * @example\n * var realtime = new Realtime({\n *   appId: appId,\n *   plugins: TypedMessagesPlugin,\n * });\n */\nexport const TypedMessagesPlugin = {\n  name,\n  messageClasses: [\n    FileMessage,\n    ImageMessage,\n    AudioMessage,\n    VideoMessage,\n    LocationMessage,\n  ],\n};\n\nexport {\n  /**\n   * @see FileMessage\n   */\n  FileMessage,\n  /**\n   * @see ImageMessage\n   */\n  ImageMessage,\n  /**\n   * @see AudioMessage\n   */\n  AudioMessage,\n  /**\n   * @see VideoMessage\n   */\n  VideoMessage,\n  /**\n   * @see LocationMessage\n   */\n  LocationMessage,\n};\n"],"names":["File","Error","TypedMessage","FileMessage","file","TypeError","id","_file","_lcfile","objId","url","metaData","Object","assign","name","getFile","this","toJSON","_parseFileFromRawData","data","createWithoutData","attributes","_url","_metaData","_name","parse","json","message","constructor","_summaryType","trim","ImageMessage","AudioMessage","VideoMessage","LocationMessage","geoPoint","GeoPoint","latitude","_geoPoint","longitude","_lcloc","getLocation","location","text","TypedMessagesPlugin","messageClasses"],"mappings":"kjCAGA,IAAKA,aACG,IAAIC,MAAM,uCCDlB,IAAKC,qBACG,IAAID,MAAM,4CCIGE,yBAMPC,cACJA,aAAgBJ,cACd,IAAIK,UAAU,8BAEC,iBAAZD,EAAKE,SACR,IAAIL,MAAM,mFAGbM,MAAQH,IACRI,QAAU,CACbC,MAAOL,EAAKE,GACZI,IAAKN,EAAKM,MACVC,SAAUC,OAAOC,OAAOT,EAAKO,YAAc,GAAI,CAC7CG,KAAMV,EAAKU,8CAmBjBC,QAAA,kBACSC,KAAKT,SAGdU,OAAA,mCAEaA,mBACTb,KAAMY,KAAKD,UAAUE,cAIlBC,sBAAP,SAA6BC,OACrBA,IAAQA,EAAKX,cACX,IAAIP,MAAM,qCAEdK,EAAKa,EAAKX,QAAQC,MACJ,iBAAPH,IACTA,EAAK,QAEDF,EAAOJ,OAAKoB,kBAAkBd,UACpCF,EAAKiB,WAAajB,EAAKiB,YAAc,GACrCjB,EAAKkB,KAAOH,EAAKX,QAAQE,IACzBN,EAAKiB,WAAWX,IAAMN,EAAKkB,KAC3BlB,EAAKmB,UAAYJ,EAAKX,QAAQG,UAAY,GAC1CP,EAAKiB,WAAWV,SAAWP,EAAKmB,UAC5BJ,EAAKX,QAAQG,WACfP,EAAKoB,MAAQL,EAAKX,QAAQG,SAASG,KACnCV,EAAKiB,WAAWP,KAAOV,EAAKoB,OAEvBpB,KAGFqB,MAAP,SAAaC,EAAMC,OACXvB,EAAOY,KAAKE,sBAAsBQ,UACjCxB,eAAauB,MAAMC,EAAMC,GAAW,IAAIX,KAAKZ,8CA1C7C,WAAIY,KAAKY,YAAYC,0BAAiBb,KAAKT,MAAMO,QACtD,IAAKgB,cA/B8B5B,gBA4EzCC,EAAY0B,aAAe,oBASd,GAAG1B,kBACH,WAAWA,oBACTA,OCvFT4B,iFAAqB5B,GAC3B4B,EAAaF,aAAe,oBASf,GAAGE,oBACDA,OCXTC,iFAAqB7B,GAC3B6B,EAAaH,aAAe,oBASf,GAAGG,oBACDA,OCXTC,iFAAqB9B,GAC3B8B,EAAaJ,aAAe,oBASf,GAAGI,oBACDA,OCXMC,yBAKPC,cACJA,aAAoBC,kBAClB,IAAI/B,UAAU,uCAIdgC,0BADHC,UAAYH,GACTE,SAAUE,EAAcJ,EAAdI,mBACbC,OAAS,CAAEH,SAAAA,EAAUE,UAAAA,uCAgB5BE,YAAA,kBACSzB,KAAKsB,aAGdrB,OAAA,mCAEaA,mBACTyB,SAAU1B,KAAKyB,cAAcxB,cAI1BQ,MAAP,SAAaC,EAAMC,SACeD,EAAKc,OAA7BH,IAAAA,SAAUE,IAAAA,UACZJ,EAAW,IAAIC,WAAS,CAAEC,SAAAA,EAAUE,UAAAA,WACnCrC,eAAauB,MAAMC,EAAMC,GAAW,IAAIX,KAAKmB,8CArB7C,eAAQnB,KAAK2B,MAAQ,IAAKb,cArBQ5B,+BAqDhC,GAAGgC,kBACH,UAAUA,oBACRA,OC9CFU,EAAsB,CACjC9B,gDACA+B,eAAgB,CACd1C,EACA4B,EACAC,EACAC,EACAC"}